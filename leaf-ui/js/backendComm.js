
var global_analysisResult = {};

function backendComm(js_object){
	//console.log(JSON.stringify(js_object));
	
	//Add object here to test
	var singlePath = {
			  "elementList": [
				    {
				      "id": "0000",
				      "status": [
				        "1100",
				        "1110",
				        "1110",
				        "1100",
				        "1100",
				        "0100",
				        "0000",
				        "0000"
				      ]
				    },
				    {
				      "id": "0001",
				      "status": [
				        "0011",
				        "1110",
				        "0011",
				        "0000",
				        "1110",
				        "0110",
				        "0010",
				        "0000"
				      ]
				    },
				    {
				      "id": "0002",
				      "status": [
				        "1100",
				        "0010",
				        "1110",
				        "1110",
				        "1100",
				        "0000",
				        "0000",
				        "0010"
				      ]
				    }
				  ],
				  "finalAssignedEpoch": [
				    "TA0_0",
				    "TA2_4",
				    "TR3_99",
				    "TA1_2",
				    "TR5_93",
				    "TR4_48",
				    "TR7_95",
				    "TR6_74"
				  ],
				  "finalValueTimePoints": [
				    "0",
				    "2",
				    "4",
				    "48",
				    "74",
				    "93",
				    "95",
				    "99"
				  ],
				  "relativeTimePoints": 5,
				  "absoluteTimePoints": [
				    2,
				    4
				  ]
				};
	var getNextStates = {"elementList":[],"allSolution":[{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0010"]},{"id":"1","status":["1100","0011","1100","0000","0010"]},{"id":"2","status":["1100","0011","1100","0000","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0011"]},{"id":"1","status":["1100","0011","1100","0000","0011"]},{"id":"2","status":["1100","0011","1100","0000","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0000"]},{"id":"1","status":["1100","0011","1100","0000","0000"]},{"id":"2","status":["1100","0011","1100","0000","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0111"]},{"id":"1","status":["1100","0011","1100","0000","0111"]},{"id":"2","status":["1100","0011","1100","0000","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0110"]},{"id":"1","status":["1100","0011","1100","0000","0110"]},{"id":"2","status":["1100","0011","1100","0000","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","0100"]},{"id":"1","status":["1100","0011","1100","0000","0100"]},{"id":"2","status":["1100","0011","1100","0000","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","1110"]},{"id":"1","status":["1100","0011","1100","0000","1110"]},{"id":"2","status":["1100","0011","1100","0000","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0000","1100"]},{"id":"1","status":["1100","0011","1100","0000","1100"]},{"id":"2","status":["1100","0011","1100","0000","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0011"]},{"id":"1","status":["1100","0011","1100","0011","0011"]},{"id":"2","status":["1100","0011","1100","0011","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0010"]},{"id":"1","status":["1100","0011","1100","0011","0010"]},{"id":"2","status":["1100","0011","1100","0011","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0000"]},{"id":"1","status":["1100","0011","1100","0011","0000"]},{"id":"2","status":["1100","0011","1100","0011","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0100"]},{"id":"1","status":["1100","0011","1100","0011","0100"]},{"id":"2","status":["1100","0011","1100","0011","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0110"]},{"id":"1","status":["1100","0011","1100","0011","0110"]},{"id":"2","status":["1100","0011","1100","0011","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","0111"]},{"id":"1","status":["1100","0011","1100","0011","0111"]},{"id":"2","status":["1100","0011","1100","0011","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","1110"]},{"id":"1","status":["1100","0011","1100","0011","1110"]},{"id":"2","status":["1100","0011","1100","0011","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0011","1100"]},{"id":"1","status":["1100","0011","1100","0011","1100"]},{"id":"2","status":["1100","0011","1100","0011","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0010"]},{"id":"1","status":["1100","0011","1100","0010","0010"]},{"id":"2","status":["1100","0011","1100","0010","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0011"]},{"id":"1","status":["1100","0011","1100","0010","0011"]},{"id":"2","status":["1100","0011","1100","0010","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0000"]},{"id":"1","status":["1100","0011","1100","0010","0000"]},{"id":"2","status":["1100","0011","1100","0010","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0111"]},{"id":"1","status":["1100","0011","1100","0010","0111"]},{"id":"2","status":["1100","0011","1100","0010","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0110"]},{"id":"1","status":["1100","0011","1100","0010","0110"]},{"id":"2","status":["1100","0011","1100","0010","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","0100"]},{"id":"1","status":["1100","0011","1100","0010","0100"]},{"id":"2","status":["1100","0011","1100","0010","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","1100"]},{"id":"1","status":["1100","0011","1100","0010","1100"]},{"id":"2","status":["1100","0011","1100","0010","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0010","1110"]},{"id":"1","status":["1100","0011","1100","0010","1110"]},{"id":"2","status":["1100","0011","1100","0010","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0100"]},{"id":"1","status":["1100","0011","1100","0110","0100"]},{"id":"2","status":["1100","0011","1100","0110","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0110"]},{"id":"1","status":["1100","0011","1100","0110","0110"]},{"id":"2","status":["1100","0011","1100","0110","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0111"]},{"id":"1","status":["1100","0011","1100","0110","0111"]},{"id":"2","status":["1100","0011","1100","0110","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0000"]},{"id":"1","status":["1100","0011","1100","0110","0000"]},{"id":"2","status":["1100","0011","1100","0110","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0011"]},{"id":"1","status":["1100","0011","1100","0110","0011"]},{"id":"2","status":["1100","0011","1100","0110","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","0010"]},{"id":"1","status":["1100","0011","1100","0110","0010"]},{"id":"2","status":["1100","0011","1100","0110","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","1110"]},{"id":"1","status":["1100","0011","1100","0110","1110"]},{"id":"2","status":["1100","0011","1100","0110","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0110","1100"]},{"id":"1","status":["1100","0011","1100","0110","1100"]},{"id":"2","status":["1100","0011","1100","0110","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0000"]},{"id":"1","status":["1100","0011","1100","0111","0000"]},{"id":"2","status":["1100","0011","1100","0111","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0010"]},{"id":"1","status":["1100","0011","1100","0111","0010"]},{"id":"2","status":["1100","0011","1100","0111","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0011"]},{"id":"1","status":["1100","0011","1100","0111","0011"]},{"id":"2","status":["1100","0011","1100","0111","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0100"]},{"id":"1","status":["1100","0011","1100","0111","0100"]},{"id":"2","status":["1100","0011","1100","0111","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0110"]},{"id":"1","status":["1100","0011","1100","0111","0110"]},{"id":"2","status":["1100","0011","1100","0111","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","0111"]},{"id":"1","status":["1100","0011","1100","0111","0111"]},{"id":"2","status":["1100","0011","1100","0111","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","1100"]},{"id":"1","status":["1100","0011","1100","0111","1100"]},{"id":"2","status":["1100","0011","1100","0111","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0111","1110"]},{"id":"1","status":["1100","0011","1100","0111","1110"]},{"id":"2","status":["1100","0011","1100","0111","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0000"]},{"id":"1","status":["1100","0011","1100","0100","0000"]},{"id":"2","status":["1100","0011","1100","0100","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0011"]},{"id":"1","status":["1100","0011","1100","0100","0011"]},{"id":"2","status":["1100","0011","1100","0100","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0010"]},{"id":"1","status":["1100","0011","1100","0100","0010"]},{"id":"2","status":["1100","0011","1100","0100","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0111"]},{"id":"1","status":["1100","0011","1100","0100","0111"]},{"id":"2","status":["1100","0011","1100","0100","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0110"]},{"id":"1","status":["1100","0011","1100","0100","0110"]},{"id":"2","status":["1100","0011","1100","0100","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","0100"]},{"id":"1","status":["1100","0011","1100","0100","0100"]},{"id":"2","status":["1100","0011","1100","0100","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","1100"]},{"id":"1","status":["1100","0011","1100","0100","1100"]},{"id":"2","status":["1100","0011","1100","0100","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","0100","1110"]},{"id":"1","status":["1100","0011","1100","0100","1110"]},{"id":"2","status":["1100","0011","1100","0100","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","1100"]},{"id":"1","status":["1100","0011","1100","1110","1100"]},{"id":"2","status":["1100","0011","1100","1110","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","1110"]},{"id":"1","status":["1100","0011","1100","1110","1110"]},{"id":"2","status":["1100","0011","1100","1110","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0100"]},{"id":"1","status":["1100","0011","1100","1110","0100"]},{"id":"2","status":["1100","0011","1100","1110","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0111"]},{"id":"1","status":["1100","0011","1100","1110","0111"]},{"id":"2","status":["1100","0011","1100","1110","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0110"]},{"id":"1","status":["1100","0011","1100","1110","0110"]},{"id":"2","status":["1100","0011","1100","1110","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0010"]},{"id":"1","status":["1100","0011","1100","1110","0010"]},{"id":"2","status":["1100","0011","1100","1110","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0011"]},{"id":"1","status":["1100","0011","1100","1110","0011"]},{"id":"2","status":["1100","0011","1100","1110","0011"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1110","0000"]},{"id":"1","status":["1100","0011","1100","1110","0000"]},{"id":"2","status":["1100","0011","1100","1110","0000"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","1100"]},{"id":"1","status":["1100","0011","1100","1100","1100"]},{"id":"2","status":["1100","0011","1100","1100","1100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","1110"]},{"id":"1","status":["1100","0011","1100","1100","1110"]},{"id":"2","status":["1100","0011","1100","1100","1110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","0110"]},{"id":"1","status":["1100","0011","1100","1100","0110"]},{"id":"2","status":["1100","0011","1100","1100","0110"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","0111"]},{"id":"1","status":["1100","0011","1100","1100","0111"]},{"id":"2","status":["1100","0011","1100","1100","0111"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","0100"]},{"id":"1","status":["1100","0011","1100","1100","0100"]},{"id":"2","status":["1100","0011","1100","1100","0100"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","0010"]},{"id":"1","status":["1100","0011","1100","1100","0010"]},{"id":"2","status":["1100","0011","1100","1100","0010"]}]},{"intentionElements":[{"id":"0","status":["1100","0011","1100","1100","0011"]},{"id":"1","status":["1100","0011","1100","1100","0011"]},{"id":"2","status":["1100","0011","1100","1100","0011"]}]},{"intentionElements":[{"id":"0","status":["0000","0000","0000","0000","0000"]},{"id":"1","status":["0000","0000","0000","0000","0000"]},{"id":"2","status":["0000","0000","0000","0000","0000"]}]}],"finalAssignedEpoch":[],"finalValueTimePoints":[],"relativeTimePoints":5,"absoluteTimePoints":[2,4]};
	
	if(js_object.analysis.getNextState){
		global_analysisResult = getNextStates;
		open_analysis_viewer();
	}else{
		loadAnalysis(singlePath);		
	}
	
	/* Uncomment for server execution
	//Show in console just to see what is going to backend
	console.log(JSON.stringify(js_object));
	
	//backend script called
	var pathToCGI = "./cgi-bin/backendCom.cgi";

	$.ajax({
		url: pathToCGI,
		type: "post",
		contentType: "json",
		data:JSON.stringify(js_object),
		success: function(response){
			executeJava(js_object.analysis.getNextState);
			console.log(response);
		}
	})	.fail(function(){
		msg = "Ops! Something went wrong.";
		alert(msg);
	});
	*/
}

function executeJava(isGetNextSteps){
	var pathToCGI = "./cgi-bin/executeJava.cgi";
	$.ajax({
		url: pathToCGI,
		type: "get",
		success: function(response){
			getFileResults(isGetNextSteps);
		}
	})
	.fail(function(){
		msg = "Ops! Something went wrong. Executing java.";
		alert(msg);
	});
}


function getFileResults(isGetNextSteps){
	//backend script called
	var pathToCGI = "./cgi-bin/fileRead.cgi";

	//Executing action to send backend
	$.ajax({
		url: pathToCGI,
		type: "get",
		success: function(response){
			analysisResults = JSON.parse(response.data);
			if (analysisResults == ""){
				alert("Sorry Dave, We could not process your model")
				return
			}
			
			if(isGetNextSteps){
				global_analysisResult = analysisResults;
				open_analysis_viewer();
			}else{
				loadAnalysis(analysisResults);				
				var currentValueLimit = parseInt(sliderObject.sliderElement.noUiSlider.get());
				var sliderMax = currentValueLimit + currentAnalysis.timeScale;
				sliderObject.sliderElement.noUiSlider.set(sliderMax);
			}
		console.log(JSON.stringify(response));
		}
	})
	.fail(function(){
		msg = "Ops! Something went wrong getting file.";
		alert(msg);
	});
}


function open_analysis_viewer(){
	var urlBase = document.URL.substring(0, document.URL.lastIndexOf('/')+1);
	var url = urlBase+"analysis.html";	

	var w = window.open(url, "Analysis View", "status=0,title=0,height=600,width=1200,scrollbars=1");
	
	if (!w) {
	    alert('You must allow popups for this map to work.');
	}

}


